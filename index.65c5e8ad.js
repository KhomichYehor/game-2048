function t(){switch(a.getState().forEach((t,e)=>{t.forEach((t,s)=>{let r="field-cell";r+=t>=2?` field-cell--${t}`:"",i[e][s].innerText=t||"",i[e][s].className=r})}),o.innerText=a.getScore(),a.getStatus().toUpperCase()){case"WIN":s("WIN");break;case"LOSE":s("LOSE");break;case"NO_MOVES":s("NO_MOVES");break;default:n.querySelectorAll(".message").forEach(t=>t.classList.add("hidden"))}}function e(t){l.classList.toggle("start"),l.classList.toggle("restart"),l.innerText=t.toUpperCase()}function s(t){let e;switch(t.toUpperCase()){case"WIN":e=".message-win";break;case"LOSE":e=".message-lose";break;case"START":e=".message-start";break;case"NO_MOVES":e=".message-no-moves";break;default:throw Error("unknown type")}n.querySelector(e).classList.remove("hidden")}class r{static get deafultSize(){return 4}static get deafultInitialState(){return Array(r.deafultSize).fill(null).map(t=>Array(r.deafultSize).fill(0))}#t="idle";#e=0;#s=!1;#r;#a;constructor(t=r.deafultInitialState,e=!1){this.#a=t.map(t=>[...t]),this.#i(),this.#s=e}moveLeft(){let t=!1;return("playing"===this.#t||this.#s)&&(this.#r.forEach(e=>{let s=new Set,r=[];for(let a=0;a<e.length;a++){if(0===e[a]){r.push(a);continue}let i=a;r.length&&(i=r.shift(),r.push(a),e[i]=e[a],e[a]=0,t=!0);let o=i-1;o>=0&&e[o]===e[i]&&!s.has(o)&&(s.add(o),e[o]*=2,e[i]=0,r.unshift(i),this.#e+=e[o],t=!0,e[o]>=2048&&(this.#t="win"))}}),t&&this.#o(),this.#s||this.#n()||(this.#t="lose")),t}moveRight(){this.#l();let t=this.moveLeft();return this.#l(),t}moveUp(){this.#h();let t=this.moveLeft();return this.#h(),t}moveDown(){this.#h();let t=this.moveRight();return this.#h(),t}getScore(){return this.#e}getState(){return this.#r.map(t=>[...t])}getStatus(){return this.#t}start(){this.#o(),this.#o(),this.#t="playing"}restart(){this.#i(),this.#e=0,this.#t="idle"}#i(){this.#r=this.#a.map(t=>[...t])}#n(){let t=new r(this.getState(),!0);return t.moveLeft()||t.moveRight()||t.moveUp()||t.moveDown()}#o(){let t=this.#c();if(!t.length)return!1;let e=Math.floor(Math.random()*t.length),{x:s,y:r}=t[e];return this.#r[r][s]=Math.random()>.1?2:4,!0}#c(){let t=[];return this.#r.forEach((e,s)=>{e.forEach((e,r)=>{0===e&&t.push({x:r,y:s})})}),t}#l(){this.#r.forEach(t=>t.reverse())}#h(){this.#r=this.#r.map((t,e)=>{let s=[];for(let r=0;r<t.length;r++)s.push(this.#r[r][e]);return s})}}const a=new r,i=Array.from(document.querySelector(".game-field").querySelectorAll(".field-row")).map(t=>Array.from(t.children)),o=document.querySelector(".game-score"),n=document.querySelector(".message-container"),l=document.querySelector(".button.start");document.addEventListener("keydown",function(e){if("playing"===a.getStatus()){switch(e.key){case"ArrowDown":a.moveDown();break;case"ArrowLeft":a.moveLeft();break;case"ArrowRight":a.moveRight();break;case"ArrowUp":a.moveUp()}t()}}),l.addEventListener("click",function(){switch(a.getStatus()){case"idle":a.start(),e("restart"),function(){let t=document.querySelector(".message-start");t&&t.remove()}();break;case"playing":case"win":case"lose":a.restart(),e("start"),s("START")}t()});
//# sourceMappingURL=index.65c5e8ad.js.map
